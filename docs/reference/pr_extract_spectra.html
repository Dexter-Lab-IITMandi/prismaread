<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract values and statistics from a PRISMA hyperspectral cube
 converted with pr_convert — pr_extract_spectra • prismaread</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract values and statistics from a PRISMA hyperspectral cube
 converted with pr_convert — pr_extract_spectra" />
<meta property="og:description" content="function to extract values of a PRISMA image converted
 with prismaread on points/polygons saved on a vector file or on
 a `sf` object" />
<meta property="og:image" content="https://github.com/lbusett/prismaread/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prismaread</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prismaread.html">Get started</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lbusett/prismaread/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Importing-Level-1-Data.html">Importing Level 1 Data</a>
    </li>
    <li>
      <a href="../articles/Importing-Level-2-Data.html">Importing Level 2 Data</a>
    </li>
    <li>
      <a href="../articles/Computing-Spectral-Indexes.html">Computing Spectral Indexes</a>
    </li>
    <li>
      <a href="../articles/Output-Format-and-Naming.html">Output Format and Naming</a>
    </li>
    <li>
      <a href="../articles/Extracting-data-over-vector.html">Extracting Data Over Vector Features</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract values and statistics from a PRISMA hyperspectral cube
 converted with pr_convert</h1>
    <small class="dont-index">Source: <a href='https://github.com/lbusett/prismaread/blob/master/R/pr_extract_spectra.R'><code>R/pr_extract_spectra.R</code></a></small>
    <div class="hidden name"><code>pr_extract_spectra.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>function to extract values of a PRISMA image converted
 with prismaread on points/polygons saved on a vector file or on
 a `sf` object</p>
    </div>

    <pre class="usage"><span class='fu'>pr_extract_spectra</span>(
  <span class='kw'>in_file</span>,
  <span class='kw'>in_vect</span>,
  id_field = <span class='kw'>NULL</span>,
  dissolve = <span class='fl'>FALSE</span>,
  stats = <span class='fl'>TRUE</span>,
  selstats = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mean"</span>, <span class='st'>"stdev"</span>),
  stats_format = <span class='st'>"long"</span>,
  quantiles = <span class='fl'>FALSE</span>,
  percs = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.05</span>, <span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span>, <span class='fl'>0.95</span>),
  allpix = <span class='fl'>FALSE</span>,
  out_file = <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>in_file</th>
      <td><p>input PRISMA file obtained with `pr_convert`</p></td>
    </tr>
    <tr>
      <th>in_vect</th>
      <td><p>either the full path to a vector file, or a `sf` object
containing the points/polygons on which data should be extracted</p></td>
    </tr>
    <tr>
      <th>id_field</th>
      <td><p>`character` (Optional), name of the column of the vector
dataset to be used to "name" the outputs, and also "aggregate" them in case
`dissolve` is TRUE.
If NULL, a arbitrary `ID` field is created, and each point/polygon
is considered separately (see Details),  Default: NULL</p></td>
    </tr>
    <tr>
      <th>dissolve</th>
      <td><p>`logical` If TRUE and `id_field` was specified, in case
multiple features of the input vector share a common id, they are dissolved
before extracting the data, Default: FALSE</p></td>
    </tr>
    <tr>
      <th>stats</th>
      <td><p>`logical` IF TRUE, compute standard statistics (mean, min, max,
sd, variation coefficient) on the vector features. Statistics to be
computed are set using the `selstats` argument, Default: TRUE</p></td>
    </tr>
    <tr>
      <th>selstats</th>
      <td><p>`character` containing the statistics to be computed.
Possible values are: "mean", "stdev","variance","coeffvar", "min","max",
Default: c("mean", "stdev")</p></td>
    </tr>
    <tr>
      <th>stats_format</th>
      <td><p>`character` ["long" | "wide"] defines the format used for
statistics output. If "long", the output has one column for the ID of the
feature, and one column for each statistic. If "wide", the output has one
column for each ID/statistic couple (e.g., mean_id_1, stdev_id_1, mean_id_2,
etcetera)</p></td>
    </tr>
    <tr>
      <th>quantiles</th>
      <td><p>`logical`, if TRUE, also compute quantiles on the vector
features. Computed quantiles are set using the `percs` argument,
Default: FALSE</p></td>
    </tr>
    <tr>
      <th>percs</th>
      <td><p>`(sorted) numeric array [0,1]` defines which quantiles should be
computed if `quantiles` is TRUE, Default: c(0.05,0.25,0.50,0.75,0.95)</p></td>
    </tr>
    <tr>
      <th>allpix</th>
      <td><p>`logical` IF TRUE, also save the values for all pixels of the
`in_vect` features in the `allpix` slot of the output list, Default: FALSE</p></td>
    </tr>
    <tr>
      <th>out_file</th>
      <td><p>`character` full path of an output file where results should
be stored, with extension. Valid extensions are ".csv", ".xls", ".xlsx"
and ".RData". If NULL, output is not saved, Default: NULL</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>format of the output varies based on arguments `allpix` and `stats`
 1. If stats = TRUE and allpix = FALSE: a `tibble` containing extracted
    statistics, for each feature of the input and each wavelength.
    Format depends on `stat_sformat`;
 2. If stats = FALSE and allpix = TRUE:  a `tibble` containing extracted
    raster values for each pixel of each feature of the input and each
    wavelength;
 3. If stats = TRUE and allpix = TRUE:  a `list` in which the `stats` slot
    contains statistics, and the `allpix` slot contains pixel values;</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()){
 <span class='kw'>in_file</span> <span class='op'>&lt;-</span> <span class='st'>"D:/prismareaetd/L2D/testL2D_HCO_VNIR.envi"</span>
 <span class='kw'>in_vect</span> <span class='op'>&lt;-</span> <span class='st'>"D:/prismaread/test/testpoints_l2d_polys.gpkg"</span>
 <span class='co'># extract base statistics</span>
 <span class='kw'>test</span> <span class='op'>&lt;-</span> <span class='fu'>pr_extract_spectra</span>(<span class='kw'>in_file</span>, <span class='kw'>in_vect</span>,
                            out_file = <span class='st'>"D:/Temp/test1.xlsx"</span>)
 <span class='kw'>test</span>
 <span class='co'># plot results using ggplot</span>
 <span class='fu'>ggplot</span>(<span class='kw'>test</span>, <span class='fu'>aes</span>(x = <span class='kw'>wvl</span>, y = <span class='kw'>mean</span>)) <span class='op'>+</span>
   <span class='fu'>geom_line</span>(<span class='fu'>aes</span>(color = <span class='kw'>ID</span>, group = <span class='kw'>ID</span>)) <span class='op'>+</span>
   <span class='fu'>facet_wrap</span>(<span class='op'>~</span><span class='kw'>ID</span>) <span class='op'>+</span>
   <span class='fu'>theme_light</span>()

 <span class='co'># extract base statistics ands save results as excel file, in "wide" format</span>
 <span class='kw'>test</span> <span class='op'>&lt;-</span> <span class='fu'>pr_extract_spectra</span>(<span class='kw'>in_file</span>, <span class='kw'>in_vect</span>,
                            out_file = <span class='st'>"D:/Temp/test1.xlsx"</span>,
                            stats_format = <span class='st'>"wide"</span>)
 <span class='kw'>test</span>

 <span class='co'># extract custom statistics</span>
 <span class='kw'>test</span> <span class='op'>&lt;-</span> <span class='fu'>pr_extract_spectra</span>(<span class='kw'>in_file</span>, <span class='kw'>in_vect</span>,
                            selstats = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mean"</span>, <span class='st'>"coeffvar"</span>, <span class='st'>"stdev"</span>,
                                         <span class='st'>"min"</span>, <span class='st'>"max"</span>))
 <span class='co'># plot results using ggplot</span>
 <span class='fu'>ggplot</span>(<span class='kw'>test</span>, <span class='fu'>aes</span>(x = <span class='kw'>wvl</span>)) <span class='op'>+</span>
   <span class='fu'>geom_line</span>(<span class='fu'>aes</span>(y = <span class='kw'>mean</span>, color = <span class='kw'>ID</span>, group = <span class='kw'>ID</span>)) <span class='op'>+</span>
   <span class='fu'>geom_line</span>(<span class='fu'>aes</span>(y = <span class='kw'>mean</span> <span class='op'>+</span> <span class='kw'>stdev</span>, group = <span class='kw'>ID</span>), color = <span class='st'>"grey75"</span>) <span class='op'>+</span>
   <span class='fu'>geom_line</span>(<span class='fu'>aes</span>(y = <span class='kw'>mean</span> <span class='op'>-</span> <span class='kw'>stdev</span>, group = <span class='kw'>ID</span>), color = <span class='st'>"grey75"</span>) <span class='op'>+</span>
   <span class='fu'>facet_wrap</span>(<span class='op'>~</span><span class='kw'>ID</span>) <span class='op'>+</span>
   <span class='fu'>theme_light</span>()

 <span class='co'># extract custom statistics and quantiles</span>
 <span class='kw'>test</span> <span class='op'>&lt;-</span> <span class='fu'>pr_extract_spectra</span>(<span class='kw'>in_file</span>, <span class='kw'>in_vect</span>, quantiles = <span class='fl'>TRUE</span>,
                                selstats = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mean"</span>, <span class='st'>"stdev"</span>))
 <span class='kw'>test</span>

 <span class='co'># extract also all pixels</span>
 <span class='kw'>test</span> <span class='op'>&lt;-</span> <span class='fu'>pr_extract_spectra</span>(<span class='kw'>in_file</span>, <span class='kw'>in_vect</span>, allpix = <span class='fl'>TRUE</span>,
                            quantiles = <span class='fl'>TRUE</span>,
                            selstats = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mean"</span>, <span class='st'>"stdev"</span>))
 <span class='kw'>test</span><span class='op'>$</span><span class='kw'>allpix</span>

 <span class='fu'>ggplot</span>(<span class='kw'>test</span><span class='op'>$</span><span class='kw'>allpix</span>, <span class='fu'>aes</span>(x = <span class='kw'>wvl</span>)) <span class='op'>+</span>
   <span class='fu'>geom_line</span>(<span class='fu'>aes</span>(y = <span class='kw'>value</span>, group = <span class='kw'>pixel</span>, color = <span class='kw'>ID</span>), lwd = <span class='fl'>0.01</span>)  <span class='op'>+</span>
   <span class='fu'>facet_wrap</span>(<span class='op'>~</span><span class='kw'>ID</span>) <span class='op'>+</span>
   <span class='fu'>theme_light</span>()

 }
}
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lorenzo Busetto, Luigi Ranghetti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


