<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extracting Data Over Vector Features • prismaread</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extracting Data Over Vector Features">
<meta property="og:description" content="prismaread">
<meta property="og:image" content="https://github.com/lbusett/prismaread/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prismaread</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lbusett/prismaread/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Importing-Level-1-Data.html">Importing Level 1 Data</a>
    </li>
    <li>
      <a href="../articles/Importing-Level-2-Data.html">Importing Level 2 Data</a>
    </li>
    <li>
      <a href="../articles/Computing-Spectral-Indexes.html">Computing Spectral Indices</a>
    </li>
    <li>
      <a href="../articles/Output-Format-and-Naming.html">Output Format and Naming</a>
    </li>
    <li>
      <a href="../articles/Extracting-data-over-vector.html">Extracting Data Over Vector Features</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Extracting-data-over-vector_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extracting Data Over Vector Features</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lbusett/prismaread/blob/master/vignettes/Extracting-data-over-vector.Rmd"><code>vignettes/Extracting-data-over-vector.Rmd</code></a></small>
      <div class="hidden name"><code>Extracting-data-over-vector.Rmd</code></div>

    </div>

    
    
<p><code>prismaread</code> provides a very efficient function based on package <code>exactextractr</code>(<a href="https://github.com/isciences/exactextractr" class="uri">https://github.com/isciences/exactextractr</a>) for extracting and summarising data from the converted hyperspectral cubes over features of vector spatial files. The function allows computing several statistics, as well as extracting all pixel values, and saving them to RData, CSV or EXCEL files (<strong>see <a href="reference/pr_extract_spectra.html"><code>prisma_extract_spectra()</code> documentation</a> for info on available arguments</strong>).</p>
<p>For example, starting from a VNIR Cube obtained with <code><a href="../reference/pr_convert.html">pr_convert()</a></code> and a vector polygon file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lbusett.github.io/prismaread/">prismaread</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="va">in_full_path</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>, package <span class="op">=</span> <span class="st">"prismaread"</span><span class="op">)</span>,
  <span class="st">"prismaread_test_HCO_FULL.tif"</span>
<span class="op">)</span>
<span class="va">in_poly_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="st">"extdata/testdata/polys_prisma.gpkg"</span>,
  package <span class="op">=</span> <span class="st">"prismaread"</span>
<span class="op">)</span>

<span class="co"># Download and unzip using piggyback if necessary</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">in_full_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Downloading test data - this may need a long time..."</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"piggyback"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"piggyback"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">in_full_zip_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"tif$"</span>, <span class="st">"zip"</span>, <span class="va">in_full_path</span><span class="op">)</span>
  <span class="fu">piggyback</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/piggyback/reference/pb_download.html">pb_download</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">in_full_zip_path</span><span class="op">)</span>,
    repo <span class="op">=</span> <span class="st">"lbusett/prismaread"</span>,
    dest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">in_full_zip_path</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="fu">piggyback</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/piggyback/reference/pb_track.html">pb_track</a></span><span class="op">(</span>glob <span class="op">=</span> <span class="st">"inst/testdata/*.tif"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="va">in_full_zip_path</span>, exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">in_full_path</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">in_full_zip_path</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># extract base statistics, in "long" format</span>
<span class="va">extr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pr_extract_spectra.html">pr_extract_spectra</a></span><span class="op">(</span><span class="va">in_full_path</span>, <span class="va">in_poly_path</span>, id_field <span class="op">=</span> <span class="st">"field_id"</span><span class="op">)</span>
<span class="va">extr1</span>
<span class="co">#&gt; # A tibble: 2,079 x 4</span>
<span class="co">#&gt;      wvl ID     mean  stdev</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1  402. cloud 0.114 0.191 </span>
<span class="co">#&gt;  2  411. cloud 0.469 0.0768</span>
<span class="co">#&gt;  3  419. cloud 0.485 0.0788</span>
<span class="co">#&gt;  4  427. cloud 0.504 0.0811</span>
<span class="co">#&gt;  5  434. cloud 0.504 0.0813</span>
<span class="co">#&gt;  6  442. cloud 0.499 0.0811</span>
<span class="co">#&gt;  7  449. cloud 0.513 0.0833</span>
<span class="co">#&gt;  8  456. cloud 0.512 0.0838</span>
<span class="co">#&gt;  9  464. cloud 0.518 0.0851</span>
<span class="co">#&gt; 10  471. cloud 0.530 0.0871</span>
<span class="co">#&gt; # … with 2,069 more rows</span>
<span class="co"># plot results using ggplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">extr1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wvl</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">ID</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Extracting-data-over-vector_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Argument <code>stats_format</code> defines the format used for statistics’ output. If “long” (default, as above), the output has one column for the ID of the feature, and one column for each statistic. If “wide”, the output has one column for each ID/statistic couple (e.g., <code>mean_id_1</code>, <code>stdev_id_1</code>, <code>mean_id_2</code>, etcetera).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">in_vnir_path</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>, package <span class="op">=</span> <span class="st">"prismaread"</span><span class="op">)</span>,
  <span class="st">"prisma_test_HCO_VNIR.tif"</span>
<span class="op">)</span>

<span class="co"># Download and unzip using piggyback if necessary</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">in_full_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Downloading test data - this may need a long time..."</span><span class="op">)</span>
  <span class="va">in_vnir_zip_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"tif$"</span>, <span class="st">"zip"</span>, <span class="va">in_vnir_path</span><span class="op">)</span>
  <span class="fu">piggyback</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/piggyback/reference/pb_download.html">pb_download</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">in_vnir_zip_path</span><span class="op">)</span>,
    repo <span class="op">=</span> <span class="st">"lbusett/prismaread"</span>,
    dest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">in_vnir_zip_path</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="fu">piggyback</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/piggyback/reference/pb_track.html">pb_track</a></span><span class="op">(</span>glob <span class="op">=</span> <span class="st">"inst/testdata/*.tif"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="va">in_vnir_zip_path</span>, exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">in_vnir_path</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">in_vnir_zip_path</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Extract base statistics for VNIR and save results as excel file, in "wide" format</span>
<span class="va">extr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pr_extract_spectra.html">pr_extract_spectra</a></span><span class="op">(</span>
  <span class="va">in_vnir_path</span>, <span class="va">in_poly_path</span>,
  out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".xlsx"</span><span class="op">)</span>,
  stats_format <span class="op">=</span> <span class="st">"wide"</span>, id_field <span class="op">=</span> <span class="st">"field_id"</span>
<span class="op">)</span>
<span class="va">extr2</span>
<span class="co">#&gt; # A tibble: 63 x 19</span>
<span class="co">#&gt;      wvl mean_cloud stdev_cloud mean_crop_1 stdev_crop_1 mean_crop_2</span>
<span class="co">#&gt;    &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1  402.      0.114      0.191      0            0        0.000499  </span>
<span class="co">#&gt;  2  411.      0.469      0.0768     0.00860      0.00255  0.00000475</span>
<span class="co">#&gt;  3  419.      0.485      0.0788     0.0144       0.00229  0.000777  </span>
<span class="co">#&gt;  4  427.      0.504      0.0811     0.0215       0.00261  0.00540   </span>
<span class="co">#&gt;  5  434.      0.504      0.0813     0.0215       0.00245  0.00665   </span>
<span class="co">#&gt;  6  442.      0.499      0.0811     0.0206       0.00250  0.00527   </span>
<span class="co">#&gt;  7  449.      0.513      0.0833     0.0254       0.00258  0.00978   </span>
<span class="co">#&gt;  8  456.      0.512      0.0838     0.0256       0.00250  0.00928   </span>
<span class="co">#&gt;  9  464.      0.518      0.0851     0.0268       0.00282  0.0104    </span>
<span class="co">#&gt; 10  471.      0.530      0.0871     0.0301       0.00300  0.0130    </span>
<span class="co">#&gt; # … with 53 more rows, and 13 more variables: stdev_crop_2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_forest &lt;dbl&gt;, stdev_forest &lt;dbl&gt;, mean_soil_1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   stdev_soil_1 &lt;dbl&gt;, mean_soil_2 &lt;dbl&gt;, stdev_soil_2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_urban &lt;dbl&gt;, stdev_urban &lt;dbl&gt;, mean_urban_2 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   stdev_urban_2 &lt;dbl&gt;, mean_water &lt;dbl&gt;, stdev_water &lt;dbl&gt;</span></code></pre></div>
<p>Additional arguments allow specifying which statistics are needed, as well as selecting if info regarding single pixels contained in each polygon need to be returned:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract custom statistics</span>
<span class="va">extr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pr_extract_spectra.html">pr_extract_spectra</a></span><span class="op">(</span>
  <span class="va">in_vnir_path</span>, <span class="va">in_poly_path</span>,
  selstats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"coeffvar"</span>, <span class="st">"stdev"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span>,
  id_field <span class="op">=</span> <span class="st">"field_id"</span>
<span class="op">)</span>
<span class="va">extr3</span>
<span class="co">#&gt; # A tibble: 567 x 7</span>
<span class="co">#&gt;      wvl ID     mean coeffvar  stdev   min   max</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1  402. cloud 0.114    1.68  0.191  0     0.564</span>
<span class="co">#&gt;  2  411. cloud 0.469    0.164 0.0768 0.176 0.617</span>
<span class="co">#&gt;  3  419. cloud 0.485    0.163 0.0788 0.188 0.638</span>
<span class="co">#&gt;  4  427. cloud 0.504    0.161 0.0811 0.197 0.662</span>
<span class="co">#&gt;  5  434. cloud 0.504    0.161 0.0813 0.199 0.662</span>
<span class="co">#&gt;  6  442. cloud 0.499    0.163 0.0811 0.194 0.657</span>
<span class="co">#&gt;  7  449. cloud 0.513    0.162 0.0833 0.202 0.677</span>
<span class="co">#&gt;  8  456. cloud 0.512    0.164 0.0838 0.202 0.677</span>
<span class="co">#&gt;  9  464. cloud 0.518    0.164 0.0851 0.200 0.685</span>
<span class="co">#&gt; 10  471. cloud 0.530    0.164 0.0871 0.207 0.703</span>
<span class="co">#&gt; # … with 557 more rows</span>

<span class="co"># plot results using ggplot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">extr3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wvl</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">stdev</span>, ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">stdev</span>, fill <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean</span>, color <span class="op">=</span> <span class="va">ID</span>, colour <span class="op">=</span> <span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Extracting-data-over-vector_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># extract custom statistics and quantiles</span>
<span class="va">extr4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pr_extract_spectra.html">pr_extract_spectra</a></span><span class="op">(</span>
  <span class="va">in_vnir_path</span>, <span class="va">in_poly_path</span>,
  quantiles <span class="op">=</span> <span class="cn">TRUE</span>,
  selstats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"stdev"</span><span class="op">)</span>,
  id_field <span class="op">=</span> <span class="st">"field_id"</span>
<span class="op">)</span>
<span class="va">extr4</span>
<span class="co">#&gt; # A tibble: 567 x 9</span>
<span class="co">#&gt;      wvl ID     mean  stdev quant_5 quant_25 quant_50 quant_75 quant_95</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1  402. cloud 0.114 0.191    0        0        0        0.301    0.491</span>
<span class="co">#&gt;  2  411. cloud 0.469 0.0768   0.313    0.427    0.476    0.512    0.566</span>
<span class="co">#&gt;  3  419. cloud 0.485 0.0788   0.324    0.443    0.490    0.529    0.587</span>
<span class="co">#&gt;  4  427. cloud 0.504 0.0811   0.339    0.461    0.511    0.550    0.611</span>
<span class="co">#&gt;  5  434. cloud 0.504 0.0813   0.337    0.460    0.510    0.549    0.611</span>
<span class="co">#&gt;  6  442. cloud 0.499 0.0811   0.335    0.454    0.505    0.544    0.605</span>
<span class="co">#&gt;  7  449. cloud 0.513 0.0833   0.343    0.467    0.519    0.561    0.625</span>
<span class="co">#&gt;  8  456. cloud 0.512 0.0838   0.340    0.465    0.518    0.560    0.623</span>
<span class="co">#&gt;  9  464. cloud 0.518 0.0851   0.344    0.470    0.525    0.566    0.631</span>
<span class="co">#&gt; 10  471. cloud 0.530 0.0871   0.352    0.480    0.537    0.578    0.647</span>
<span class="co">#&gt; # … with 557 more rows</span>


<span class="co"># extract also all pixels</span>
<span class="va">extr5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pr_extract_spectra.html">pr_extract_spectra</a></span><span class="op">(</span>
  <span class="va">in_vnir_path</span>, <span class="va">in_poly_path</span>,
  allpix <span class="op">=</span> <span class="cn">TRUE</span>,
  selstats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"stdev"</span><span class="op">)</span>,
  id_field <span class="op">=</span> <span class="st">"field_id"</span>
<span class="op">)</span>

<span class="co"># stats are saved in the "stats" slot of the output</span>
<span class="va">extr5</span><span class="op">$</span><span class="va">stats</span>
<span class="co">#&gt; # A tibble: 567 x 4</span>
<span class="co">#&gt;      wvl ID     mean  stdev</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1  402. cloud 0.114 0.191 </span>
<span class="co">#&gt;  2  411. cloud 0.469 0.0768</span>
<span class="co">#&gt;  3  419. cloud 0.485 0.0788</span>
<span class="co">#&gt;  4  427. cloud 0.504 0.0811</span>
<span class="co">#&gt;  5  434. cloud 0.504 0.0813</span>
<span class="co">#&gt;  6  442. cloud 0.499 0.0811</span>
<span class="co">#&gt;  7  449. cloud 0.513 0.0833</span>
<span class="co">#&gt;  8  456. cloud 0.512 0.0838</span>
<span class="co">#&gt;  9  464. cloud 0.518 0.0851</span>
<span class="co">#&gt; 10  471. cloud 0.530 0.0871</span>
<span class="co">#&gt; # … with 557 more rows</span>

<span class="co"># pixel values are saved in the "allpix" slot of the output</span>
<span class="va">extr5</span><span class="op">$</span><span class="va">allpix</span>
<span class="co">#&gt; # A tibble: 295,974 x 4</span>
<span class="co">#&gt;    ID      wvl pixel   value</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 cloud  402. pix_001 0.377</span>
<span class="co">#&gt;  2 cloud  411. pix_001 0.368</span>
<span class="co">#&gt;  3 cloud  419. pix_001 0.378</span>
<span class="co">#&gt;  4 cloud  427. pix_001 0.397</span>
<span class="co">#&gt;  5 cloud  434. pix_001 0.396</span>
<span class="co">#&gt;  6 cloud  442. pix_001 0.387</span>
<span class="co">#&gt;  7 cloud  449. pix_001 0.399</span>
<span class="co">#&gt;  8 cloud  456. pix_001 0.395</span>
<span class="co">#&gt;  9 cloud  464. pix_001 0.401</span>
<span class="co">#&gt; 10 cloud  471. pix_001 0.409</span>
<span class="co">#&gt; # … with 295,964 more rows</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">extr5</span><span class="op">$</span><span class="va">allpix</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wvl</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">pixel</span>, color <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ID</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Extracting-data-over-vector_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lorenzo Busetto, Luigi Ranghetti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
